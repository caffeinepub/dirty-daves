{
  "kind": "build_request",
  "title": "Add temporary resetBootstrap admin recovery path (Candid + /admin buttons)",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Backend: Add a temporary public shared method resetBootstrap() in backend/main.mo that sets firstAdminBootstrapped := false, placed immediately after `var firstAdminBootstrapped : Bool = false;` and before `setMeAsAdmin()`.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "Please add a temporary public method to reset the flag, like this:\n\npublic shared func resetBootstrap() : async () {\n  firstAdminBootstrapped := false;\n};"
        ]
      },
      "acceptanceCriteria": [
        "backend/main.mo contains a `public shared func resetBootstrap() : async ()` that sets `firstAdminBootstrapped := false`",
        "The canister Candid interface exposes `resetBootstrap` with no arguments",
        "Calling `resetBootstrap()` followed by `setMeAsAdmin()` from the same principal successfully assigns #admin even if the flag had been stuck true"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Frontend: When an authenticated user is shown the /admin AccessDeniedScreen (logged in but not admin), add a temporary \"Reset Bootstrap\" button that calls the backend `resetBootstrap()` method, shows success/failure UI, and then allows the user to click the existing \"Set Me as Admin\" button to call `setMeAsAdmin()` immediately after.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "If easier, add temporary buttons on /admin (when access denied):\n- \"Reset Bootstrap\" button that calls resetBootstrap()\n- \"Set Me as Admin\" button that calls setMeAsAdmin()"
        ]
      },
      "acceptanceCriteria": [
        "On /admin, for authenticated non-admin users, a \"Reset Bootstrap\" button is visible alongside the existing \"Set Me as Admin\" button",
        "Clicking \"Reset Bootstrap\" calls `actor.resetBootstrap()` and displays a clear success message when it succeeds",
        "If reset fails, the error is displayed in the existing error area or a new error area without breaking the page",
        "After reset succeeds, clicking \"Set Me as Admin\" successfully grants admin and the user can access the submissions page (assuming no other RBAC issues)"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Frontend: Add a small, explicit security warning in the authenticated AccessDeniedScreen UI that `resetBootstrap()` is temporary and must be removed/disabled after an admin is successfully bootstrapped.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "After I become admin and can see form submissions:\n- Remind me to remove/comment out resetBootstrap() for security."
        ]
      },
      "acceptanceCriteria": [
        "The access-denied (authenticated) UI includes a warning message stating that resetBootstrap is temporary and should be removed/disabled after bootstrapping admin",
        "The warning text is in English and visible without needing to open devtools"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Docs: Update frontend/PRODUCTION_CONFIGURATION.md to include explicit steps and exact URL pattern for opening the Candid UI for the backend canister to call `resetBootstrap()` and then `setMeAsAdmin()` (including the recommended a4gq6... Candid UI URL with `?id=<BACKEND_CANISTER_ID>` and guidance to obtain the canister id from the Diagnostics page).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "How do I open the Candid UI to call resetBootstrap() manually? (exact URL or steps, e.g. https://fd6rd-maaaa-aaaah-atocq-cai.icp0.io/ + ?canisterId or dashboard link)\n- After calling resetBootstrap(), how do I call setMeAsAdmin() right after?"
        ]
      },
      "acceptanceCriteria": [
        "frontend/PRODUCTION_CONFIGURATION.md contains a copy/paste-ready URL pattern for Candid UI that includes `?id=<BACKEND_CANISTER_ID>`",
        "The docs explicitly say to call `resetBootstrap()` first, then `setMeAsAdmin()` immediately after, and that both can be done from the same Candid UI",
        "The docs mention where to find the backend canister id in the app (Diagnostics page)"
      ]
    },
    {
      "id": "REQ-5",
      "text": "Deployment: Redeploy backend + frontend changes and ensure the live environment reflects the update.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "Deployed the changes (or please redeploy if needed).",
          "Deploy any updates and tell me when it's live."
        ]
      },
      "acceptanceCriteria": [
        "A new live deployment is produced that includes the backend `resetBootstrap()` method and the updated /admin UI",
        "Smoke test: user can log in, click Reset Bootstrap, then click Set Me as Admin, and then load the contact submissions admin page without unauthorized errors (for that principal)"
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo (no additional canisters/services).",
    "Do not edit files under frontend/src/components/ui or other frontend immutablePaths listed in SYSTEM_CONTEXT; compose existing components instead.",
    "User-facing text must be in English."
  ],
  "nonGoals": [
    "Do not add new authentication providers beyond Internet Identity.",
    "Do not redesign the RBAC system beyond the temporary bootstrap recovery mechanism.",
    "Do not build real-time features or external database integrations."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}