{
  "kind": "build_request",
  "title": "Configure ICP custom domain verification assets for dirtydaves.co.uk (+ www) and prepare for redeploy",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Ensure the deployed frontend serves a `/.well-known/ic-domains` text file that contains exactly two lines (one domain per line) with no extra spaces, quotes, or trailing blank lines:\n1) `dirtydaves.co.uk`\n2) `www.dirtydaves.co.uk`\nThe file must be located at `frontend/public/.well-known/ic-domains` so it is included in the static asset deployment.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-msg-1"
        ],
        "quotes": [
          "Put the following exact content in the ic-domains file (one domain per line, no extra spaces or quotes):\ndirtydaves.co.uk\nwww.dirtydaves.co.uk"
        ]
      },
      "acceptanceCriteria": [
        "Repository contains `frontend/public/.well-known/ic-domains`.",
        "`frontend/public/.well-known/ic-domains` content matches exactly:\n`dirtydaves.co.uk\\nwww.dirtydaves.co.uk` (newline-separated, no additional newline at end preferred).",
        "When deployed, `GET /.well-known/ic-domains` returns HTTP 200 and the response body is exactly those two lines."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Create a static file `frontend/public/.well-known/ii-alternative-origins` (no file extension) containing exactly this one-line JSON:\n{\"alternativeOrigins\":[\"https://dirtydaves.co.uk\",\"https://www.dirtydaves.co.uk\"]}\nEnsure it is deployed as a public static asset at `/.well-known/ii-alternative-origins`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-msg-1"
        ],
        "quotes": [
          "Also in the .well-known folder, create another plain text file named \"ii-alternative-origins\" with this exact content (JSON format, one line):\n{\"alternativeOrigins\":[\"https://dirtydaves.co.uk\",\"https://www.dirtydaves.co.uk\"]}"
        ]
      },
      "acceptanceCriteria": [
        "Repository contains `frontend/public/.well-known/ii-alternative-origins`.",
        "File content matches exactly the provided JSON on a single line.",
        "When deployed, `GET /.well-known/ii-alternative-origins` returns HTTP 200."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add an asset configuration file `frontend/public/.ic-assets.json` that configures content types and disables caching (max_age: 0) for the two `/.well-known` files, using exactly this JSON structure and paths:\n{\n  \"assets\": [\n    {\n      \"path\": \"/.well-known/ic-domains\",\n      \"content_type\": \"text/plain\",\n      \"cache\": { \"max_age\": 0 }\n    },\n    {\n      \"path\": \"/.well-known/ii-alternative-origins\",\n      \"content_type\": \"application/json\",\n      \"cache\": { \"max_age\": 0 }\n    }\n  ]\n}\n",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-msg-1"
        ],
        "quotes": [
          "(If your setup supports/requires it) Create a file named \".ic-assets.json\" in the root of the assets/public folder (or next to index.html) with this content to help with caching and headers for the .well-known files:"
        ]
      },
      "acceptanceCriteria": [
        "Repository contains `frontend/public/.ic-assets.json` with the exact JSON provided in the request (paths, content_type values, and cache.max_age).",
        "On deployment, responses for `/.well-known/ic-domains` and `/.well-known/ii-alternative-origins` are served with appropriate `Content-Type` and are not aggressively cached (max-age 0)."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Update the production smoke test documentation to reflect the new expected `/.well-known/ic-domains` content (two lines including `www`) and add a verification check for `/.well-known/ii-alternative-origins` returning the exact JSON payload.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-msg-1"
        ],
        "quotes": [
          "After redeploy, please check and confirm to me that the file is publicly accessible by telling me what shows up at this URL: https://fd6rd-maaaa-aaaah-atocq-cai.icp0.io/.well-known/ic-domains"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/SMOKE_TEST_PRODUCTION.md` section \"Custom Domain Verification\" expects `dirtydaves.co.uk` and `www.dirtydaves.co.uk` (and no extra lines).",
        "Smoke test includes a step to fetch and verify `/.well-known/ii-alternative-origins` content."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Add a short post-deploy checklist note (in an existing deployment/production doc) listing the remaining manual steps outside Caffeine for domain setup for canister `fd6rd-maaaa-aaaah-atocq-cai`, including the exact DNS records and the optional boundary-node registration/status URLs the user provided.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-msg-1"
        ],
        "quotes": [
          "Once that's done and confirmed live, remind me of the remaining manual steps I need to do outside Caffeine:\n- Add these DNS records..."
        ]
      },
      "acceptanceCriteria": [
        "A production/deployment documentation file includes the user-provided DNS records verbatim:\n- CNAME @/apex → dirtydaves.co.uk.icp1.io\n- CNAME www → www.dirtydaves.co.uk.icp1.io\n- TXT _canister-id.dirtydaves.co.uk → fd6rd-maaaa-aaaah-atocq-cai\n- CNAME _acme-challenge.dirtydaves.co.uk → _acme-challenge.dirtydaves.co.uk.icp2.io\n(and note about www if needed).",
        "Documentation includes verbatim optional commands/URLs:\n- `curl -sL -X POST https://icp0.io/custom-domains/v1/dirtydaves.co.uk`\n- `https://icp0.io/custom-domains/v1/dirtydaves.co.uk` for status."
      ]
    }
  ],
  "constraints": [
    "Do not modify files under the immutable frontend paths listed in SYSTEM_CONTEXT (e.g., `frontend/src/main.tsx`, `frontend/src/hooks/useInternetIdentity.ts(x)`, `frontend/src/hooks/useActor.ts`, `frontend/src/components/ui`).",
    "Keep all changes limited to static asset files and documentation; no backend changes are required for serving `frontend/public` assets."
  ],
  "nonGoals": [
    "Do not attempt to configure DNS on the user’s registrar from within the project.",
    "Do not claim to have executed a redeploy, published a new live version, or performed live HTTP checks from within this build request; provide steps/checklist only.",
    "Do not change the canister ID (must remain `fd6rd-maaaa-aaaah-atocq-cai`)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}